<!doctype html>

<html lang="en" class="light-style layout-menu-fixed layout-compact" dir="ltr" data-theme="theme-default"
    data-assets-path="../assets/" data-template="vertical-menu-template-free" data-style="light">

<head>
    <meta charset="utf-8" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

    <title>WA Wot - By Abhinavelaveni</title>

    <meta name="description" content="" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../assets/img/favicon/favicon.ico" />
    <!-- Tabler Icons CSS -->
    <link href="https://cdn.jsdelivr.net/npm/@tabler/icons@latest/iconfont/tabler-icons.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">


    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
        rel="stylesheet" />

    <link rel="stylesheet" href="../assets/vendor/fonts/boxicons.css" />

    <!-- Core CSS -->
    <link rel="stylesheet" href="../assets/vendor/css/core.css" class="template-customizer-core-css" />
    <link rel="stylesheet" href="../assets/vendor/css/theme-default.css" class="template-customizer-theme-css" />
    <link rel="stylesheet" href="../assets/css/demo.css" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />
    <link rel="stylesheet" href="../assets/vendor/libs/apex-charts/apex-charts.css" />

    <!-- Page CSS -->

    <!-- Helpers -->
    <script src="../assets/vendor/js/helpers.js"></script>
    <script src="../assets/vendor/js/myjavascript.js"></script>
    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <script src="../assets/vendor/js/template-customizer.js"></script>
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script src="../assets/js/config.js"></script>
    <style>
        .file-list .file-row,
        .existing-file {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .file-list input[type="text"] {
            flex: 1 1 auto;
            max-width: 250px;
        }

        .quick-item {
            border-bottom: 1px solid #eaeaea;
            padding: 0.5rem 0;
        }

        #logsContainer {
            height: 250px;
            overflow-y: auto;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 0.25rem;
        }

        .device-logs {
            margin-bottom: 1rem;
            border-bottom: 1px solid #eaeaea;
            padding-bottom: 0.5rem;
        }

        .logs table {
            font-size: 0.875rem;
        }
    </style>
</head>

<body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
        <div class="layout-container">
            <!-- Menu -->

            <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
                <div class="app-brand demo">
                    <a href="index.html" class="app-brand-link">
                        <span class="app-brand-logo demo">

                        </span>
                        <span class="app-brand-text demo menu-text fw-bold ms-2">WA Bot</span>
                    </a>

                    <a href="javascript:void(0);"
                        class="layout-menu-toggle menu-link text-large ms-auto d-block d-xl-none">
                        <i class="bx bx-chevron-left bx-sm d-flex align-items-center justify-content-center"></i>
                    </a>
                </div>

                <div class="menu-inner-shadow"></div>

                <ul class="menu-inner py-1">
                    <!-- Dashboards -->
                    <li class="menu-item active open">
                        <a href="index.html" class="menu-link d-flex align-items-center">
                            <i class="menu-icon tf-icons bx bx-home-smile me-2"></i>
                            <div class="text-truncate" data-i18n="Dashboards">Dashboards</div>
                            <span class="badge rounded-pill bg-danger ms-auto" id="online-devices-count">0</span>
                        </a>
                    </li>

                    <!-- <li class="menu-item">
                        <div class="menu-link px-0">
                            <select class="form-select main-device" id="deviceSelector"
                                style="cursor: pointer; width: 100%;">
                                <option value="forgot">Select Device</option>
                            </select>
                            <script>document.addEventListener("DOMContentLoaded", () => {
                                    const deviceSelector = document.getElementById("deviceSelector");

                                    // Fetch devices from the backend
                                    fetch("http://localhost:3000/clients") // Update the URL if needed
                                        .then((response) => {
                                            if (!response.ok) {
                                                throw new Error(`Error fetching devices: ${response.statusText}`);
                                            }
                                            return response.json();
                                        })
                                        .then((devices) => {
                                            // Populate the dropdown
                                            devices.forEach((device) => {
                                                const option = document.createElement("option");
                                                option.value = device.name;
                                                option.textContent = `${device.name}`;
                                                deviceSelector.appendChild(option);
                                            });
                                        })
                                        .catch((error) => {
                                            console.error(error);
                                        });

                                    // Event listener for device selection
                                    deviceSelector.addEventListener("change", (event) => {
                                        const selectedDevice = event.target.value;

                                        if (selectedDevice === "forgot") {
                                            console.log("No device selected.");
                                            return;
                                        }

                                        console.log(`Selected device: ${selectedDevice}`);
                                        // Perform further actions based on the selected device
                                        // Example: Fetch device details or initialize the device
                                        fetch(`http://localhost:3000/clients/${selectedDevice}`)
                                            .then((response) => {
                                                if (!response.ok) {
                                                    throw new Error(`Error fetching device details: ${response.statusText}`);
                                                }
                                                return response.json();
                                            })
                                            .then((deviceDetails) => {
                                                console.log("Device details:", deviceDetails);
                                                // Perform additional actions based on device details
                                            })
                                            .catch((error) => {
                                                console.error(error);
                                            });
                                    });
                                });
                            </script>
                        </div>
                    </li> -->
                    <!-- WhatsApp Features -->
                    <li class="menu-header small text-uppercase">
                        <span class="menu-header-text">WhatsApp Features</span>
                    </li>
                    <li class="menu-item">
                        <a href="javascript:void(0);" class="menu-link menu-toggle">
                            <i class="menu-icon tf-icons bx bx-cube-alt"></i>
                            <div class="text-truncate" data-i18n="">Auto-Features</div>
                        </a>
                        <ul class="menu-sub">
                            <li class="menu-item">
                                <a href="singlemessenger.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="#">Single Messenger</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="bulkmessaging.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="#">Bulk Message</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="greetingmessage.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="#">Greeting Message</div>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="menu-item">
                        <a href="auto-responder.html" class="menu-link">
                            <i class="menu-icon ti ti-brand-gravatar"></i>
                            <div class="text-truncate" data-i18n="">Auto-Responder</div>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="filemanager.html" class="menu-link">
                            <i class="menu-icon ti ti-file-dots"></i>
                            <div class="text-truncate" data-i18n="">File-Manager</div>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="senderlogs.html" class="menu-link">
                            <i class="menu-icon ti ti-brand-whatsapp"></i>
                            <div class="text-truncate" data-i18n="">Sender-Logs</div>
                        </a>
                    </li>

                    <!-- College Features -->
                    <li class="menu-header small text-uppercase">
                        <span class="menu-header-text">College Features</span>
                    </li>
                    <li class="menu-item">
                        <a href="javascript:void(0);" class="menu-link menu-toggle">
                            <i class="menu-icon ti ti-bell-ringing"></i>
                            <div class="text-truncate" data-i18n="">Auto Notifier</div>
                        </a>
                        <ul class="menu-sub">
                            <li class="menu-item">
                                <a href="auto-responder.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="#">Fee Reminders</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="auto-responder.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="#">Attendance Alerts</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="auto-responder.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="#">Student Performance</div>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <!-- Dept Performance -->
                    <li class="menu-item">
                        <a href="javascript:void(0);" class="menu-link menu-toggle">
                            <i class="menu-icon ti ti-brand-office"></i>
                            <div class="text-truncate" data-i18n="">Dept Performance</div>
                        </a>
                        <ul class="menu-sub">
                            <li class="menu-item">
                                <a href="auto-responder.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="#">HODs</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="auto-responder.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="#">Staff</div>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <!-- HODS Section -->
                    <li class="menu-item">
                        <a href="javascript:void(0);" class="menu-link menu-toggle">
                            <i class="menu-icon fa-solid fa-user-tie"></i>
                            <div class="text-truncate" data-i18n="">HOD Central</div>
                        </a>
                        <ul class="menu-sub">
                            <li class="menu-item">
                                <a href="auto-responder.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="#">Announcements</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="auto-responder.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="#">Academic and Exam Management</div>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link">
                            <i class="menu-icon fa-solid fa-calendar-days"></i>
                            <div class="text-truncate" data-i18n="">Events</div>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link">
                            <i class="menu-icon ti ti-message-circle"></i>
                            <div class="text-truncate" data-i18n="">Quick Replies</div>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link">
                            <i class="menu-icon ti ti-brand-whatsapp"></i>
                            <div class="text-truncate" data-i18n="">Sender-Logs</div>
                        </a>
                    </li>


                    <li class="menu-header small text-uppercase">
                        <span class="menu-header-text">Main &amp; Menu</span>
                    </li>
                    <li class="menu-item">
                        <a href="javascript:void(0);" class="menu-link menu-toggle">
                            <i class="menu-icon tf-icons bx bx-dock-top"></i>
                            <div class="text-truncate" data-i18n="Account Settings">Account Settings</div>
                        </a>
                        <ul class="menu-sub">
                            <li class="menu-item">
                                <a href="pages-account-settings-account.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Account">Account</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="pages-account-settings-notifications.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Notifications">Notifications</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="pages-account-settings-connections.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Connections">Connections</div>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="menu-item">
                        <a href="javascript:void(0);" class="menu-link menu-toggle">
                            <i class="menu-icon tf-icons bx bx-lock-open-alt"></i>
                            <div class="text-truncate" data-i18n="Authentications">Authentications</div>
                        </a>
                        <ul class="menu-sub">
                            <li class="menu-item">
                                <a href="auth-login-basic.html" class="menu-link" target="_blank">
                                    <div class="text-truncate" data-i18n="Basic">Login</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="auth-register-basic.html" class="menu-link" target="_blank">
                                    <div class="text-truncate" data-i18n="Basic">Register</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="auth-forgot-password-basic.html" class="menu-link" target="_blank">
                                    <div class="text-truncate" data-i18n="Basic">Forgot Password</div>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="menu-item">
                        <a href="javascript:void(0);" class="menu-link menu-toggle">
                            <i class="menu-icon tf-icons bx bx-cube-alt"></i>
                            <div class="text-truncate" data-i18n="Misc">Misc</div>
                        </a>
                        <ul class="menu-sub">
                            <li class="menu-item">
                                <a href="pages-misc-error.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Error">Error</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="pages-misc-under-maintenance.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Under Maintenance">Under Maintenance</div>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <!-- Components -->
                    <li class="menu-header small text-uppercase"><span class="menu-header-text">Components</span></li>
                    <!-- Cards -->
                    <li class="menu-item">
                        <a href="cards-basic.html" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-collection"></i>
                            <div class="text-truncate" data-i18n="Basic">Cards</div>
                        </a>
                    </li>
                    <!-- User interface -->
                    <li class="menu-item">
                        <a href="javascript:void(0)" class="menu-link menu-toggle">
                            <i class="menu-icon tf-icons bx bx-box"></i>
                            <div class="text-truncate" data-i18n="User interface">User interface</div>
                        </a>
                        <ul class="menu-sub">
                            <li class="menu-item">
                                <a href="ui-accordion.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Accordion">Accordion</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="ui-alerts.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Alerts">Alerts</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="ui-badges.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Badges">Badges</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="ui-buttons.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Buttons">Buttons</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="ui-carousel.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Carousel">Carousel</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="ui-collapse.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Collapse">Collapse</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="ui-dropdowns.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Dropdowns">Dropdowns</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="ui-footer.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Footer">Footer</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="ui-list-groups.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="List Groups">List groups</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="ui-modals.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Modals">Modals</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="ui-navbar.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Navbar">Navbar</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="ui-offcanvas.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Offcanvas">Offcanvas</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="ui-pagination-breadcrumbs.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Pagination & Breadcrumbs">Pagination &amp;
                                        Breadcrumbs</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="ui-progress.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Progress">Progress</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="ui-spinners.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Spinners">Spinners</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="ui-tabs-pills.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Tabs & Pills">Tabs &amp; Pills</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="ui-toasts.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Toasts">Toasts</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="ui-tooltips-popovers.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Tooltips & Popovers">Tooltips &amp; Popovers
                                    </div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="ui-typography.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Typography">Typography</div>
                                </a>
                            </li>
                        </ul>
                    </li>

                    <!-- Extended components -->
                    <li class="menu-item">
                        <a href="javascript:void(0)" class="menu-link menu-toggle">
                            <i class="menu-icon tf-icons bx bx-copy"></i>
                            <div class="text-truncate" data-i18n="Extended UI">Extended UI</div>
                        </a>
                        <ul class="menu-sub">
                            <li class="menu-item">
                                <a href="extended-ui-perfect-scrollbar.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Perfect Scrollbar">Perfect Scrollbar</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="extended-ui-text-divider.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Text Divider">Text Divider</div>
                                </a>
                            </li>
                        </ul>
                    </li>

                    <li class="menu-item">
                        <a href="icons-boxicons.html" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-crown"></i>
                            <div class="text-truncate" data-i18n="Boxicons">Boxicons</div>
                        </a>
                    </li>

                    <!-- Forms & Tables -->
                    <li class="menu-header small text-uppercase"><span class="menu-header-text">Forms &amp;
                            Tables</span></li>
                    <!-- Forms -->
                    <li class="menu-item">
                        <a href="javascript:void(0);" class="menu-link menu-toggle">
                            <i class="menu-icon tf-icons bx bx-detail"></i>
                            <div class="text-truncate" data-i18n="Form Elements">Form Elements</div>
                        </a>
                        <ul class="menu-sub">
                            <li class="menu-item">
                                <a href="forms-basic-inputs.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Basic Inputs">Basic Inputs</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="forms-input-groups.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Input groups">Input groups</div>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="menu-item">
                        <a href="javascript:void(0);" class="menu-link menu-toggle">
                            <i class="menu-icon tf-icons bx bx-detail"></i>
                            <div class="text-truncate" data-i18n="Form Layouts">Form Layouts</div>
                        </a>
                        <ul class="menu-sub">
                            <li class="menu-item">
                                <a href="form-layouts-vertical.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Vertical Form">Vertical Form</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="form-layouts-horizontal.html" class="menu-link">
                                    <div class="text-truncate" data-i18n="Horizontal Form">Horizontal Form</div>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <!-- Tables -->
                    <li class="menu-item">
                        <a href="tables-basic.html" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-table"></i>
                            <div class="text-truncate" data-i18n="Tables">Tables</div>
                        </a>
                    </li>
                    <!-- Misc -->
                    <li class="menu-header small text-uppercase"><span class="menu-header-text">Misc</span></li>
                    <li class="menu-item">
                        <a href="https://github.com/themeselection/sneat-html-admin-template-free/issues"
                            target="_blank" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-support"></i>
                            <div class="text-truncate" data-i18n="Support">Support</div>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="https://demos.themeselection.com/sneat-bootstrap-html-admin-template/documentation/"
                            target="_blank" class="menu-link">
                            <i class="menu-icon tf-icons bx bx-file"></i>
                            <div class="text-truncate" data-i18n="Documentation">Documentation</div>
                        </a>
                    </li>
                </ul>
            </aside>
            <!-- / Menu -->

            <!-- Layout container -->
            <div class="layout-page">
                <!-- Navbar -->

                <nav class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme"
                    id="layout-navbar">
                    <div class="layout-menu-toggle navbar-nav align-items-xl-center me-4 me-xl-0 d-xl-none">
                        <a class="nav-item nav-link px-0 me-xl-6" href="javascript:void(0)">
                            <i class="bx bx-menu bx-md"></i>
                        </a>
                    </div>

                    <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
                        <!-- Search -->
                        <div class="navbar-nav align-items-center">
                            <div class="nav-item d-flex align-items-center">
                                <i class="bx bx-search bx-md"></i>
                                <input type="text" class="form-control border-0 shadow-none ps-1 ps-sm-2"
                                    placeholder="Search..." aria-label="Search..." />
                            </div>
                        </div>
                        <!-- /Search -->

                        <ul class="navbar-nav flex-row align-items-center ms-auto">
                            <!-- Place this tag where you want the button to render. -->
                            <li class="nav-item lh-1 me-4">
                                <a class="github-button"
                                    href="https://github.com/themeselection/sneat-html-admin-template-free"
                                    data-icon="octicon-star" data-size="large" data-show-count="true"
                                    aria-label="Star themeselection/sneat-html-admin-template-free on GitHub">Star</a>
                            </li>

                            <!-- User -->
                            <li class="nav-item navbar-dropdown dropdown-user dropdown">
                                <a class="nav-link dropdown-toggle hide-arrow p-0" href="javascript:void(0);"
                                    data-bs-toggle="dropdown">
                                    <div class="avatar avatar-online">
                                        <img src="../assets/img/avatars/1.png" alt
                                            class="w-px-40 h-auto rounded-circle" />
                                    </div>
                                </a>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li>
                                        <a class="dropdown-item" href="#">
                                            <div class="d-flex">
                                                <div class="flex-shrink-0 me-3">
                                                    <div class="avatar avatar-online">
                                                        <img src="../assets/img/avatars/1.png" alt
                                                            class="w-px-40 h-auto rounded-circle" />
                                                    </div>
                                                </div>
                                                <div class="flex-grow-1">
                                                    <h6 class="mb-0">John Doe</h6>
                                                    <small class="text-muted">Admin</small>
                                                </div>
                                            </div>
                                        </a>
                                    </li>
                                    <li>
                                        <div class="dropdown-divider my-1"></div>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="#">
                                            <i class="bx bx-user bx-md me-3"></i><span>My Profile</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="#"> <i
                                                class="bx bx-cog bx-md me-3"></i><span>Settings</span> </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="#">
                                            <span class="d-flex align-items-center align-middle">
                                                <i class="flex-shrink-0 bx bx-credit-card bx-md me-3"></i><span
                                                    class="flex-grow-1 align-middle">Billing Plan</span>
                                                <span class="flex-shrink-0 badge rounded-pill bg-danger">4</span>
                                            </span>
                                        </a>
                                    </li>
                                    <li>
                                        <div class="dropdown-divider my-1"></div>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="javascript:void(0);">
                                            <i class="bx bx-power-off bx-md me-3"></i><span>Log Out</span>
                                        </a>
                                    </li>
                                </ul>
                            </li>
                            <!--/ User -->
                        </ul>
                    </div>
                </nav>
                <!-- / Navbar -->
                <div class="wrapper">
                    <div class="container py-5">
                        <!-- Header -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="d-flex justify-content-center align-items-center">
                                    <div>
                                        <h1 class="mb-3 text-center">
                                            <i class="fab fa-whatsapp me-2"></i>WhatsApp Quick Replies Manager
                                        </h1>
                                        <p class="text-muted mb-0 d-flex justify-content-center align-items-center ">
                                            Create • Edit • Files & Captions • Stats
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <!-- Left Column - Quick Reply Management -->
                            <div class="col-lg-8">
                                <!-- Device Selector -->
                                <div class="card device-selector shadow-sm mb-4">
                                    <div class="card-body py-2">
                                        <div class="row align-items-center">
                                            <div class="col-md-6">
                                                <label class="form-label fw-bold">Select Device</label>
                                                <select id="deviceSelect" class="form-select">
                                                    <option value="">Select Device</option>
                                                </select>
                                            </div>
                                            <div
                                                class="col-md-6 d-flex align-items-center justify-content-md-end mt-3 mt-md-0">
                                                <div class="form-check form-switch mb-0">
                                                    <input class="form-check-input" type="checkbox" id="autoReplySwitch"
                                                        checked />
                                                    <label class="form-check-label ms-2"
                                                        for="autoReplySwitch">Auto-reply Enabled</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Quick Reply Form -->
                                <div class="card shadow-sm mb-4">
                                    <div class="card-header card-header-custom py-3">
                                        <h2 class="h5 mb-0">
                                            <i class="fas fa-plus-circle me-2"></i>Quick Reply — Create / Update
                                        </h2>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label fw-semibold">Trigger Key</label>
                                                <input id="keyInput" class="form-control"
                                                    placeholder="e.g., hello, pricing, support" />
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label fw-semibold">Device</label>
                                                <select id="deviceForQuick" class="form-select"></select>
                                            </div>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label fw-semibold">Reply Text</label>
                                            <textarea id="replyInput" class="form-control" rows="3"
                                                placeholder="Type your reply message here..."></textarea>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label fw-semibold">Attach Files</label>
                                            <input id="fileInput" class="form-control" type="file" multiple />
                                            <div class="form-text">
                                                You can select multiple files to attach to this quick reply
                                            </div>
                                            <div id="fileList" class="file-list mt-2 text-wrap"></div>
                                        </div>

                                        <div class="form-check mb-3">
                                            <input type="checkbox" class="form-check-input" id="replaceFilesCheckbox" />
                                            <label class="form-check-label" for="replaceFilesCheckbox">Replace existing
                                                files when saving</label>
                                        </div>

                                        <div class="d-flex gap-2 mb-3 flex-wrap">
                                            <button class="btn btn-primary" onclick="createOrUpdateQuick()">
                                                <i class="fas fa-save me-1"></i>Save Quick Reply
                                            </button>
                                            <button class="btn btn-outline-secondary"
                                                onclick="loadQuickRepliesForSelected(true)">
                                                <i class="fas fa-sync-alt me-1"></i>Refresh List
                                            </button>
                                            <button class="btn btn-outline-danger" onclick="deleteSelectedQuick()">
                                                <i class="fas fa-trash-alt me-1"></i>Delete Key
                                            </button>
                                        </div>

                                        <div id="quickAlert"></div>
                                    </div>
                                </div>

                                <!-- Active Quick Replies -->
                                <div class="card shadow-sm">
                                    <div class="card-header bg-white py-3">
                                        <h2 class="h5 mb-0">
                                            <i class="fas fa-list me-2"></i>Active Quick Replies
                                        </h2>
                                    </div>
                                    <div class="card-body">
                                        <div class="quick-list" id="quickRepliesList" style="min-height: 100px;">
                                            <div class="text-center py-4">
                                                <div class="spinner-border text-primary" role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                                <p class="mt-2 text-muted">Loading quick replies...</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Right Column - Controls & Stats -->
                            <div class="col-lg-4">
                                <!-- Stats Card -->
                                <div class="card shadow-sm mb-4">
                                    <div class="card-header bg-white py-3">
                                        <h2 class="h5 mb-0"><i class="fas fa-chart-bar me-2"></i>Quick Reply Stats</h2>
                                    </div>
                                    <div class="card-body">
                                        <div class="input-group mb-3">
                                            <input id="statsDevice" class="form-control"
                                                placeholder="Device for stats" />
                                            <button class="btn btn-primary" onclick="loadQuickReplyStats()">
                                                <i class="fas fa-chart-line me-1"></i>Load
                                            </button>
                                        </div>
                                        <div class="stats-container" id="statsOutput">
                                            <div class="text-muted text-center py-3">Stats will appear here</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Recent Logs -->
                                <div class="card shadow-sm">
                                    <div
                                        class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                                        <h2 class="h5 mb-0"><i class="fas fa-terminal me-2"></i>Recent Logs</h2>
                                        <button class="btn btn-sm btn-outline-primary" onclick="loadRecentLogs()"
                                            title="Reload">
                                            <i class="fas fa-sync-alt"></i>
                                        </button>
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="p-3 border-bottom">
                                            <form id="logsFilterForm" class="row g-2 align-items-center">
                                                <div class="col-md">
                                                    <input id="logsDeviceFilter" class="form-control form-control-sm"
                                                        placeholder="Device filter (optional)" />
                                                </div>
                                                <div class="col-auto">
                                                    <input id="logsLimit" type="number" min="1" value="10"
                                                        class="form-control form-control-sm" style="max-width: 100px"
                                                        title="Limit" />
                                                </div>
                                                <div class="col-auto">
                                                    <button type="submit" class="btn btn-sm btn-outline-primary w-100">
                                                        <i class="fas fa-search me-1"></i>Filter
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                        <div class="logs" id="logsContainer" style="height: 250px; overflow-y: auto;">
                                            <div class="text-center py-4" id="logsLoading">
                                                <div class="spinner-border spinner-border-sm text-primary"
                                                    role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                                <p class="mt-2 text-muted small">Loading logs...</p>
                                            </div>
                                            <table class="table table-sm table-hover mb-0 d-none" id="logsTable"
                                                style="table-layout: fixed; word-wrap: break-word;">
                                                <thead class="table-light sticky-top">
                                                    <tr>
                                                        <th scope="col" style="width: 30px;">#</th>
                                                        <th scope="col" style="width: 100px;">Device</th>
                                                        <th scope="col" style="width: 110px;">Key / Message</th>
                                                        <th scope="col" style="width: 120px;">Number / Level</th>
                                                        <th scope="col" style="width: 70px;">Type</th>
                                                        <th scope="col" style="width: 70px;">Status</th>
                                                        <th scope="col" style="width: 130px;">Created At</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="logsTableBody"></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <script>
                    const API_BASE = (window.location.hostname === 'localhost') ? 'http://localhost:3000/api' : '/api';

                    // --- Devices ---

                    async function populateDeviceSelects() {
                        try {
                            const res = await fetch(`${API_BASE}/clients/connected`);
                            const data = await res.json();
                            const ids = ['deviceSelect', 'deviceForQuick', 'statsDevice'];
                            ids.forEach(id => {
                                const el = document.getElementById(id);
                                if (!el) return;
                                el.innerHTML = '<option value="">Select Device</option>';
                            });
                            (data.clients || []).forEach(c => {
                                ids.forEach(id => {
                                    const sel = document.getElementById(id);
                                    if (!sel) return;
                                    const opt = document.createElement('option');
                                    opt.value = c.name;
                                    opt.textContent = c.name;
                                    sel.appendChild(opt);
                                });
                            });
                            // Optional: load from saved selection or pick first device
                            // For simplicity, no auto-select
                        } catch (e) {
                            console.warn('populateDeviceSelects', e);
                            showQuickAlert('quickAlert', 'Failed to load devices', 'error');
                        }
                    }

                    // --- Files for quick reply ---

                    let selectedFiles = [];

                    function setupFileInput() {
                        const inp = document.getElementById('fileInput');
                        inp.addEventListener('change', (e) => {
                            selectedFiles = Array.from(e.target.files || []);
                            renderFileList();
                        });
                    }

                    function renderFileList() {
                        const c = document.getElementById('fileList');
                        c.innerHTML = '';

                        if (selectedFiles.length === 0) {
                            c.innerHTML = '<div class="text-muted text-center py-2">No files selected</div>';
                            return;
                        }

                        selectedFiles.forEach((f, i) => {
                            const div = document.createElement('div');
                            div.className = 'file-row';
                            div.innerHTML = `
        <div style="flex:1;overflow-wrap: anywhere;">${escapeHtml(f.name)} <span class="muted">(${formatBytes(f.size)})</span></div>
        <input type="text" class="form-control form-control-sm" placeholder="Caption (optional)" data-file-idx="${i}" />
        <button class="btn btn-sm btn-outline-danger" onclick="removeFile(${i})" title="Remove file">
          <i class="fas fa-times"></i>
        </button>
      `;
                            c.appendChild(div);
                        });
                    }

                    function removeFile(i) {
                        selectedFiles.splice(i, 1);
                        renderFileList();
                        document.getElementById('fileInput').value = '';
                    }

                    function formatBytes(bytes) {
                        if (!bytes) return '0 B';
                        const units = ['B', 'KB', 'MB', 'GB'];
                        let j = 0;
                        while (bytes >= 1024 && j < units.length - 1) {
                            bytes /= 1024;
                            j++;
                        }
                        return `${bytes.toFixed(2)} ${units[j]}`;
                    }

                    function escapeHtml(s) {
                        if (!s && s !== 0) return '';
                        return String(s).replace(/[&<>"']/g, function (m) {
                            return ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' })[m] || m;
                        });
                    }

                    // --- Quick Reply Create/Update ---

                    async function createOrUpdateQuick() {
                        const device = document.getElementById('deviceForQuick').value;
                        const key = document.getElementById('keyInput').value.trim();
                        const reply = document.getElementById('replyInput').value || '';
                        const replaceFiles = document.getElementById('replaceFilesCheckbox').checked;

                        if (!device) return showQuickAlert('quickAlert', 'Please select a device', 'error');
                        if (!key) return showQuickAlert('quickAlert', 'Please enter a trigger key', 'error');

                        // Gather captions aligned to selected files
                        const captions = [];
                        const captionInputs = document.querySelectorAll('#fileList input[type=text]');
                        captionInputs.forEach(inp => captions.push(inp.value || ''));

                        const fd = new FormData();
                        fd.append('key', key);
                        fd.append('reply', reply);

                        selectedFiles.forEach((f, idx) => {
                            fd.append('files', f);
                            fd.append('captions[]', captions[idx] || '');
                        });

                        try {
                            showQuickAlert('quickAlert', 'Saving quick reply...', 'info');
                            const url = `${API_BASE}/${encodeURIComponent(device)}/quick-replies${replaceFiles ? '?replace=1' : ''}`;
                            const res = await fetch(url, { method: 'POST', body: fd });
                            const j = await res.json();

                            if (!res.ok) throw new Error(j.error || JSON.stringify(j));

                            showQuickAlert('quickAlert', j.message || 'Quick reply saved successfully', 'success');

                            // Clear form and file inputs
                            document.getElementById('keyInput').value = '';
                            document.getElementById('replyInput').value = '';
                            document.getElementById('fileInput').value = '';
                            selectedFiles = [];
                            renderFileList();

                            await loadQuickRepliesForSelected(true);
                        } catch (e) {
                            console.error(e);
                            showQuickAlert('quickAlert', e.message || 'Failed to save quick reply', 'error');
                        }
                    }

                    // --- Load Quick Replies List ---

                    async function loadQuickRepliesForSelected(showAlertOnEmpty = true) {
                        const device = document.getElementById('deviceForQuick').value || document.getElementById('deviceSelect').value;
                        const container = document.getElementById('quickRepliesList');
                        if (!device) {
                            container.innerHTML = '<div class="text-muted text-center py-3">Select a device to view quick replies</div>';
                            return;
                        }
                        try {
                            container.innerHTML = `
        <div class="text-center py-2">
          <div class="spinner-border spinner-border-sm text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <span class="ms-2">Loading quick replies...</span>
        </div>
      `;
                            const res = await fetch(`${API_BASE}/${encodeURIComponent(device)}/quick-replies`);
                            const arr = await res.json();
                            container.innerHTML = '';
                            if (!Array.isArray(arr) || arr.length === 0) {
                                if (showAlertOnEmpty) container.innerHTML = '<div class="text-muted text-center py-4">No quick replies found for this device</div>';
                                return;
                            }
                            arr.forEach(q => {
                                const div = document.createElement('div');
                                div.className = 'quick-item';
                                div.innerHTML = `
          <div class="d-flex justify-content-between align-items-start flex-wrap">
            <div class="flex-grow-1 mb-2 mb-md-0">
              <h6 class="mb-1 text-primary">${escapeHtml(q.key)}</h6>
              <p class="mb-1 text-muted small">${escapeHtml((q.reply || '').substring(0, 100)) || '<em>No text reply</em>'}</p>
              ${q.files && q.files.length
                                        ? `<div class="mt-2">
                       ${q.files
                                            .slice(0, 3)
                                            .map(
                                                f => `<span class="badge bg-light text-dark me-1 mb-1"><i class="fas fa-file me-1"></i>${escapeHtml(f.name)}</span>`
                                            )
                                            .join('')}
                       ${q.files.length > 3
                                            ? `<span class="badge bg-light text-dark">+${q.files.length - 3} more</span>`
                                            : ''
                                        }
                     </div>`
                                        : ''
                                    }
            </div>
            <div class="d-flex gap-1 flex-wrap ms-md-2">
              <button class="btn btn-sm btn-outline-success" title="Edit" onclick="populateForEdit('${encodeURIComponent(device)}', '${encodeURIComponent(q.key)}')">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-sm btn-outline-danger" title="Delete" onclick="deleteQuick('${encodeURIComponent(device)}', '${encodeURIComponent(q.key)}')">
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
          </div>
        `;
                                container.appendChild(div);
                            });
                        } catch (e) {
                            console.error(e);
                            container.innerHTML = '<div class="text-muted text-center py-3">Error loading quick replies</div>';
                        }
                    }

                    // --- Populate Quick Reply Form For Editing ---

                    async function populateForEdit(device, key) {
                        const decDevice = decodeURIComponent(device);
                        const decKey = decodeURIComponent(key);

                        document.getElementById('deviceForQuick').value = decDevice;
                        document.getElementById('keyInput').value = decKey;

                        try {
                            const res = await fetch(`${API_BASE}/${encodeURIComponent(decDevice)}/quick-replies`);
                            const arr = await res.json();
                            const found = (arr || []).find(r => r.key === decKey);
                            if (found) {
                                document.getElementById('replyInput').value = found.reply || '';
                                renderExistingFiles(decDevice, decKey, found.files || []);
                                document.getElementById('keyInput').scrollIntoView({ behavior: 'smooth' });
                            } else {
                                document.getElementById('replyInput').value = '';
                                document.getElementById('fileList').innerHTML = '<div class="text-muted text-center py-2">No existing files</div>';
                            }
                        } catch (e) {
                            console.warn(e);
                            showQuickAlert('quickAlert', 'Failed to load quick reply details', 'error');
                        }
                    }

                    // --- Render Existing Files ---

                    function renderExistingFiles(device, key, files) {
                        const c = document.getElementById('fileList');
                        c.innerHTML = '';

                        if (files.length === 0) {
                            c.innerHTML = '<div class="text-muted text-center py-2">No existing files</div>';
                            return;
                        }

                        const header = document.createElement('div');
                        header.className = 'fw-semibold mb-2';
                        header.textContent = 'Existing Files:';
                        c.appendChild(header);

                        files.forEach(f => {
                            const d = document.createElement('div');
                            d.className = 'existing-file d-flex align-items-center gap-2 mb-1 flex-wrap';

                            d.innerHTML = `
        <div style="flex-grow:1;overflow-wrap: anywhere;">
          <div class="fw-medium">${escapeHtml(f.name)}</div>
          <div class="text-muted small">${f.uploadDate ? 'Uploaded: ' + new Date(f.uploadDate).toLocaleString() : ''}</div>
        </div>
        <input type="text" class="form-control form-control-sm me-2 mt-1 mt-md-0" placeholder="Caption" value="${escapeHtml(f.caption || '')}" disabled style="max-width:200px"/>
        <button class="btn btn-sm btn-outline-primary me-1 mt-1 mt-md-0" onclick="downloadFile('${encodeURIComponent(device)}', '${f.id}')" title="Download">
          <i class="fas fa-download"></i>
        </button>
        <button class="btn btn-sm btn-outline-danger mt-1 mt-md-0" onclick="deleteFile('${encodeURIComponent(device)}', '${encodeURIComponent(key)}', ${f.id})" title="Delete file">
          <i class="fas fa-trash-alt"></i>
        </button>
      `;
                            c.appendChild(d);
                        });

                        const note = document.createElement('div');
                        note.className = 'text-muted small mt-2';
                        note.textContent = 'Note: You can add new files using the file input above';
                        c.appendChild(note);
                    }

                    // --- Delete Quick Reply ---

                    async function deleteQuick(device, key) {
                        if (!confirm(`Are you sure you want to delete the quick reply "${decodeURIComponent(key)}"?`)) return;

                        try {
                            const res = await fetch(`${API_BASE}/${device}/quick-replies/${encodeURIComponent(decodeURIComponent(key))}`, { method: 'DELETE' });
                            if (!res.ok) throw new Error('Delete failed');
                            showQuickAlert('quickAlert', 'Quick reply deleted successfully', 'success');
                            await loadQuickRepliesForSelected();
                        } catch (e) {
                            console.error(e);
                            showQuickAlert('quickAlert', 'Failed to delete quick reply', 'error');
                        }
                    }

                    function deleteSelectedQuick() {
                        const device = document.getElementById('deviceForQuick').value;
                        const key = document.getElementById('keyInput').value.trim();

                        if (!device) return showQuickAlert('quickAlert', 'Please select a device', 'error');
                        if (!key) return showQuickAlert('quickAlert', 'Please enter a key to delete', 'error');

                        deleteQuick(encodeURIComponent(device), key);
                    }

                    // --- Delete File ---

                    async function deleteFile(device, key, fileId) {
                        if (!confirm('Are you sure you want to delete this file?')) return;

                        try {
                            const res = await fetch(`${API_BASE}/${device}/quick-replies/${decodeURIComponent(key)}/files/${fileId}`, { method: 'DELETE' });
                            if (!res.ok) throw new Error('Delete file failed');
                            showQuickAlert('quickAlert', 'File deleted successfully', 'success');
                            await loadQuickRepliesForSelected();
                            const curKey = document.getElementById('keyInput').value.trim();
                            if (curKey) populateForEdit(decodeURIComponent(device), curKey);
                        } catch (e) {
                            console.error(e);
                            showQuickAlert('quickAlert', 'Failed to delete file', 'error');
                        }
                    }

                    // --- Download File ---

                    function downloadFile(device, fileId) {
                        window.open(`${API_BASE}/files/${fileId}`, '_blank');
                    }

                    // --- Send Test Message ---

                    async function sendTestMessage() {
                        const device = document.getElementById('deviceForQuick').value;
                        const number = document.getElementById('testSendNumber').value.trim();
                        const key = document.getElementById('testSendKey').value.trim();

                        if (!device) return alert('Please select a device');
                        if (!number) return alert('Please enter a phone number');
                        if (!key) return alert('Please enter a quick reply key');

                        try {
                            const res = await fetch(`${API_BASE}/${encodeURIComponent(device)}/send-quick`, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ number, key })
                            });

                            const j = await res.json();
                            if (!res.ok) throw new Error(j.error || JSON.stringify(j));
                            alert('Test message sent successfully!');
                            loadRecentLogs();
                        } catch (e) {
                            console.error(e);
                            alert('Failed to send test message: ' + (e.message || e));
                        }
                    }

                    // --- Quick Reply Stats ---

                    async function loadQuickReplyStats() {
                        const device = document.getElementById('statsDevice')?.value || document.getElementById('deviceSelect')?.value;
                        const output = document.getElementById('statsOutput');

                        if (!device) {
                            output.innerHTML = '<div class="text-muted text-center py-3">Please select a device</div>';
                            return;
                        }

                        output.innerHTML = `
      <div class="text-center py-3">
        <div class="spinner-border spinner-border-sm text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2 text-muted small">Loading stats...</p>
      </div>`;

                        try {
                            const res = await fetch(`${API_BASE}/${encodeURIComponent(device)}/quick-replies/stats`);
                            const data = await res.json();

                            if (typeof data === 'object' && data !== null) {
                                let html = '';
                                if (data.topKeys && data.topKeys.length) {
                                    html += '<h6>Top Quick Reply Keys:</h6><ul class="mb-3">';
                                    data.topKeys.forEach(row => {
                                        html += `<li><strong>${escapeHtml(row.quickReplyKey)}</strong>: ${escapeHtml(row.sends)} sends</li>`;
                                    });
                                    html += '</ul>';
                                }
                                html += `<div><strong>Total Sends:</strong> ${escapeHtml(data.total || 0)}</div>`;
                                output.innerHTML = html;
                            } else {
                                output.textContent = String(data);
                            }
                        } catch (e) {
                            console.error(e);
                            output.innerHTML = '<div class="text-muted text-center py-3">Failed to load stats</div>';
                        }
                    }

                    // --- Recent Logs ---

                    const logsContainer = document.getElementById('logsContainer');
                    const logsDeviceFilter = document.getElementById('logsDeviceFilter');
                    const logsLimitInput = document.getElementById('logsLimit');
                    const logsFilterForm = document.getElementById('logsFilterForm');
                    const logsLoading = document.getElementById('logsLoading');
                    const logsTable = document.getElementById('logsTable');
                    const logsTableBody = document.getElementById('logsTableBody');

                    function showLogsLoading() {
                        logsLoading.classList.remove('d-none');
                        logsTable.classList.add('d-none');
                        logsTableBody.innerHTML = '';
                    }

                    function renderLogsTable(logs) {
                        if (!logs || logs.length === 0) {
                            logsTableBody.innerHTML = `<tr><td colspan="7" class="text-center small text-muted">No logs found</td></tr>`;
                            return;
                        }
                        logsTableBody.innerHTML = '';
                        logs.forEach((log, idx) => {
                            const typeBadge =
                                log.type === 'text'
                                    ? 'bg-primary'
                                    : log.type === 'file'
                                        ? 'bg-success'
                                        : 'bg-warning text-dark';

                            const status =
                                log.success === true
                                    ? '<span class="text-success"><i class="fas fa-check-circle"></i></span>'
                                    : '<span class="text-danger"><i class="fas fa-times-circle"></i></span>';

                            const tr = document.createElement('tr');
                            tr.innerHTML = `
        <th scope="row">${idx + 1}</th>
        <td>${escapeHtml(log.deviceName)}</td>
        <td>${escapeHtml(log.key || '')}</td>
        <td>${escapeHtml(log.number || '')}</td>
        <td><span class="badge ${typeBadge}">${escapeHtml(log.type || '')}</span></td>
        <td>${status}</td>
        <td>${new Date(log.timestamp || log.createdAt).toLocaleString()}</td>
      `;
                            logsTableBody.appendChild(tr);
                        });
                    }

                    async function loadRecentLogs(e) {
                        if (e && typeof e.preventDefault === 'function') e.preventDefault();
                        showLogsLoading();

                        const device = logsDeviceFilter.value.trim();
                        const limit = logsLimitInput.value.trim();
                        const params = new URLSearchParams();
                        if (device) params.append('device', device);
                        params.append('limit', limit || '10');

                        try {
                            const res = await fetch('/api/recent-logs?' + params);
                            if (!res.ok) throw new Error('Failed to fetch logs');
                            const logsByDevice = await res.json();

                            // Flatten grouped logs for table
                            let flatLogs = [];
                            Object.entries(logsByDevice).forEach(([deviceName, logs]) => {
                                logs.forEach(log => {
                                    flatLogs.push({ ...log, deviceName });
                                });
                            });

                            renderLogsTable(flatLogs);
                            logsLoading.classList.add('d-none');
                            logsTable.classList.remove('d-none');
                        } catch (err) {
                            logsLoading.innerHTML =
                                '<p class="text-center text-danger small mt-2">Failed to load logs.</p>';
                            console.error(err);
                        }
                    }

                    // --- Utility: Quick alert ---

                    function showQuickAlert(el, msg, type = 'success') {
                        const c = document.getElementById(el);
                        const alertClass = type === 'success' ? 'alert-success' : type === 'error' ? 'alert-danger' : 'alert-info';
                        c.innerHTML = `<div class="alert ${alertClass} alert-dismissible fade show" role="alert">
        ${escapeHtml(msg)}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>`;
                        if (type !== 'error') {
                            setTimeout(() => {
                                if (c) c.innerHTML = '';
                            }, 5000);
                        }
                    }

                    // --- Initialization ---

                    document.addEventListener('DOMContentLoaded', () => {
                        populateDeviceSelects();
                        setupFileInput();
                        loadQuickRepliesForSelected(true);
                        loadRecentLogs();

                        // Sync device selects
                        document.getElementById('deviceSelect').addEventListener('change', function () {
                            const val = this.value;
                            document.getElementById('deviceForQuick').value = val;
                            document.getElementById('statsDevice').value = val;
                            loadQuickRepliesForSelected(true);
                        });

                        // Logs filter form submit
                        logsFilterForm.addEventListener('submit', loadRecentLogs);
                    });
                </script>

                <!-- Bootstrap JS Bundle -->
                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

                <!-- Footer -->
                <footer class="content-footer footer bg-footer-theme">
                    <div class="container-xxl">
                        <div
                            class="footer-container d-flex align-items-center justify-content-between py-4 flex-md-row flex-column">
                            <div class="text-body">
                                ©
                                <script>
                                    document.write(new Date().getFullYear());
                                </script>
                                , made with ❤️ by <a href="https://github.com/abhinavelaveni"
                                    target="_blank">abhinavelaveni</a>
                            </div>
                            <div class="d-none d-lg-inline-block">
                                <a href="https://demos.themeselection.com/sneat-bootstrap-html-admin-template/documentation/"
                                    target="_blank" class="footer-link me-4">Documentation</a>

                                <a href="https://github.com/themeselection/sneat-html-admin-template-free/issues"
                                    target="_blank" class="footer-link">Support</a>
                            </div>
                        </div>
                    </div>
                </footer>
            </div>
        </div>
        <!-- / Footer -->

        <div class="content-backdrop fade"></div>
    </div>
    <!-- Content wrapper -->
    </div>
    <!-- / Layout page -->

    <!-- Overlay -->
    <div class="layout-overlay layout-menu-toggle"></div>
    </div>

    <!-- Core JS -->
    <!-- build:js assets/vendor/js/core.js -->

    <script src="../assets/vendor/libs/jquery/jquery.js"></script>
    <script src="../assets/vendor/libs/popper/popper.js"></script>
    <script src="../assets/vendor/js/bootstrap.js"></script>
    <script src="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
    <script src="../assets/vendor/js/menu.js"></script>

    <!-- endbuild -->

    <!-- Vendors JS -->
    <script src="../assets/vendor/libs/apex-charts/apexcharts.js"></script>

    <!-- Main JS -->
    <script src="../assets/js/main.js"></script>

    <!-- Page JS -->
    <script src="../assets/js/dashboards-analytics.js"></script>

    <!-- Place this tag before closing body tag for github widget button. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
</body>

</html>